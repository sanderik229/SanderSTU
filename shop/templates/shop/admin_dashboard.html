{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî SanderStu</title>
    <link rel="stylesheet" href="{% static 'shop/css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'shop/css/admin.css' %}">
</head>
<body>
<main class="admin-dashboard">
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            </div>
            <nav class="admin-nav">
                <ul>
                    <li><a href="#dashboard" class="nav-item active" data-section="dashboard">
                        <span class="nav-icon">üìä</span> –ì–ª–∞–≤–Ω–∞—è
                    </a></li>
                    <li><a href="#services" class="nav-item" data-section="services">
                        <span class="nav-icon">üõçÔ∏è</span> –£—Å–ª—É–≥–∏
                    </a></li>
                    <li><a href="#orders" class="nav-item" data-section="orders">
                        <span class="nav-icon">üìã</span> –ó–∞–∫–∞–∑—ã
                    </a></li>
                    <li><a href="#users" class="nav-item" data-section="users">
                        <span class="nav-icon">üë•</span> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                    </a></li>
                    <li><a href="#analytics" class="nav-item" data-section="analytics">
                        <span class="nav-icon">üìà</span> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                    </a></li>
                    <li><a href="#reports" class="nav-item" data-section="reports">
                        <span class="nav-icon">üìÑ</span> –û—Ç—á–µ—Ç—ã
                    </a></li>
                    <li><a href="#settings" class="nav-item" data-section="settings">
                        <span class="nav-icon">‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div class="admin-header-left">
                    <h1 id="page-title">–î–∞—à–±–æ—Ä–¥</h1>
                    <p id="page-subtitle">–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –∏ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</p>
                </div>
                <div class="admin-header-right">
                    <div class="admin-user">
                        <span class="user-name" id="adminUserName">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                        <div class="user-menu">
                            <button class="user-menu-btn">‚öôÔ∏è</button>
                            <div class="user-dropdown">
                                <a href="#" id="logoutAdmin">–í—ã–π—Ç–∏</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard" class="admin-section">
            <div class="admin-content">
                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">üí∞</div>
                        <div class="kpi-content">
                            <h3>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</h3>
                            <div class="kpi-value" id="totalRevenue">0 ‚ÇΩ</div>
                            <div class="kpi-change positive">+12.5%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üì¶</div>
                        <div class="kpi-content">
                            <h3>–ó–∞–∫–∞–∑—ã –∑–∞ –º–µ—Å—è—Ü</h3>
                            <div class="kpi-value" id="monthlyOrders">0</div>
                            <div class="kpi-change positive">+8.2%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üë•</div>
                        <div class="kpi-content">
                            <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                            <div class="kpi-value" id="activeUsers">0</div>
                            <div class="kpi-change positive">+15.3%</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">üìä</div>
                        <div class="kpi-content">
                            <h3>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</h3>
                            <div class="kpi-value" id="averageOrder">0 ‚ÇΩ</div>
                            <div class="kpi-change negative">-2.1%</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-row">
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="servicesChart"></canvas>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="recent-section">
                    <div class="section-actions">
                        <a href="#orders" class="view-all">–í—Å–µ –∑–∞–∫–∞–∑—ã ‚Üí</a>
                    </div>
                    <div class="recent-orders" id="recentOrders">
                        <!-- Orders will be loaded here -->
                    </div>
                </div>

                <!-- Notifications -->
                <div class="notifications-section">
                    <div class="section-actions">
                        <span class="notification-count" id="notificationCount">0</span>
                    </div>
                    <div class="notifications" id="notifications">
                        <!-- Notifications will be loaded here -->
                    </div>
                </div>
            </div>
            </section>

            <!-- Services Section -->
            <section id="services" class="admin-section">
                <div class="admin-content">
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>–£—Å–ª—É–≥–∏</h3>
                            <button class="btn btn-primary" onclick="adminDashboard.addService()">+ –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–°–æ—Ü—Å–µ—Ç—å</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="servicesTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="admin-section">
                <div class="admin-content">
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>–ó–∞–∫–∞–∑—ã</h3>
                        </div>
                        <div class="table-filters">
                            <div class="filters">
                                <select id="orderStatusFilter">
                                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                    <option value="new">–ù–æ–≤—ã–π</option>
                                    <option value="paid">–û–ø–ª–∞—á–µ–Ω</option>
                                    <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                                    <option value="done">–í—ã–ø–æ–ª–Ω–µ–Ω</option>
                                    <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω</option>
                                </select>
                                <input type="text" id="orderSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–∫–∞–∑–∞–º...">
                                <button class="btn btn-primary" onclick="adminDashboard.filterOrders()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                                    <th>Email</th>
                                    <th>–£—Å–ª—É–≥–∞</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users" class="admin-section">
                <div class="admin-content">
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                            <button class="btn btn-primary" onclick="adminDashboard.addUser()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Email</th>
                                    <th>–§–ò–û</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="admin-section">
                <div class="admin-content">
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>–û—Ç—á–µ—Ç—ã</h3>
                        </div>
                        <div class="reports-content">
                            <div class="report-card">
                                <h4>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç</h4>
                                <p>–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö, –∑–∞–∫–∞–∑–∞—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ —Ñ–æ—Ä–º–∞—Ç–µ PDF.</p>
                                <button class="btn btn-primary" onclick="adminDashboard.generateMonthlyReportPDF()">
                                    üìÑ –°–∫–∞—á–∞—Ç—å PDF
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="admin-section">
                <div class="admin-content">
                    <div class="charts-row">
                        <div class="chart-container">
                            <h3>–¢–æ–ø 5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —É—Å–ª—É–≥</h3>
                            <canvas id="popularServicesChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h3>
                            <canvas id="ordersStatusChart"></canvas>
                        </div>
                    </div>
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-icon">üìà</div>
                            <div class="kpi-content">
                                <h3>–í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü</h3>
                                <div class="kpi-value" id="monthRevenue">0 ‚ÇΩ</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon">üìä</div>
                            <div class="kpi-content">
                                <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h3>
                                <div class="kpi-value" id="activeOrdersCount">0</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon">üë•</div>
                            <div class="kpi-content">
                                <h3>–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                                <div class="kpi-value" id="newUsersCount">0</div>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon">üí∞</div>
                            <div class="kpi-content">
                                <h3>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</h3>
                                <div class="kpi-value" id="avgCheck">0 ‚ÇΩ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="admin-section">
                <div class="admin-content">
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
                        </div>
                        <div class="settings-grid">
                            <div class="setting-card">
                                <h4>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
                                <label>
                                    <input type="checkbox" checked> Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö
                                </label>
                                <label>
                                    <input type="checkbox" checked> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                                </label>
                                <label>
                                    <input type="checkbox"> SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                </label>
                            </div>
                            <div class="setting-card">
                                <h4>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h4>
                                <label>
                                    <input type="checkbox" checked> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                                </label>
                                <label>
                                    <input type="checkbox"> –¢—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
                                </label>
                            </div>
                            <div class="setting-card">
                                <h4>üìä –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h4>
                                <label>–í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ (–º–∏–Ω—É—Ç—ã):
                                    <input type="number" value="30" min="5" max="1440">
                                </label>
                                <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞:
                                    <input type="number" value="5" min="3" max="10">
                                </label>
                            </div>
                            <div class="setting-card">
                                <h4>üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
                                <p>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: 27.10.2025 11:30</p>
                                <button class="btn btn-primary" onclick="adminDashboard.backupDatabase()">–°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é —Å–µ–π—á–∞—Å</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</main>

<!-- Service Modal -->
<div id="serviceModal" class="modal" style="display: none;">
    <div class="modal-backdrop" onclick="closeServiceModal()"></div>
    <div class="modal-dialog">
        <div class="modal-header">
            <h3 id="serviceModalTitle">–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</h3>
            <button class="modal-close" onclick="closeServiceModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="serviceForm">
                <input type="hidden" id="serviceId" name="id">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏: <input type="text" id="serviceTitle" name="title" required></label>
                <label>–û–ø–∏—Å–∞–Ω–∏–µ: <textarea id="serviceDescription" name="description" rows="3"></textarea></label>
                <label>–¶–µ–Ω–∞: <input type="number" id="servicePrice" name="price" step="0.01" required></label>
                <label>–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å:
                    <select id="serviceSocialNetwork" name="social_network">
                        <option value="instagram">Instagram</option>
                        <option value="facebook">Facebook</option>
                        <option value="youtube">YouTube</option>
                        <option value="tiktok">TikTok</option>
                        <option value="telegram">Telegram</option>
                    </select>
                </label>
                <label>–°—Ç–∞—Ç—É—Å:
                    <select id="serviceStatus" name="is_active">
                        <option value="true">–ê–∫—Ç–∏–≤–µ–Ω</option>
                        <option value="false">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</option>
                    </select>
                </label>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeServiceModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- User Modal -->
<div id="userModal" class="modal" style="display: none;">
    <div class="modal-backdrop" onclick="closeUserModal()"></div>
    <div class="modal-dialog">
        <div class="modal-header">
            <h3 id="userModalTitle">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <button class="modal-close" onclick="closeUserModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="userForm">
                <input type="hidden" id="userId" name="id">
                <label>Email: <input type="email" id="userEmail" name="email" required></label>
                <label>–ü–∞—Ä–æ–ª—å: <input type="password" id="userPassword" name="password"></label>
                <label>–§–ò–û: <input type="text" id="userFullName" name="full_name"></label>
                <label>–†–æ–ª—å:
                    <select id="userRole" name="role">
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </label>
                <label>–°—Ç–∞—Ç—É—Å:
                    <select id="userStatus" name="is_active">
                        <option value="true">–ê–∫—Ç–∏–≤–µ–Ω</option>
                        <option value="false">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                    </select>
                </label>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeUserModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'shop/js/admin.js' %}?v=2"></script>

<script>
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('access');
    if (token) {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –¥–ª—è middleware
        fetch(window.location.href, {
            method: 'GET',
            headers: {
                'X-Access-Token': token
            }
        }).then(response => {
            if (response.ok) {
                // –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                window.location.reload();
            }
        }).catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:', error);
        });
    } else {
        // –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        window.location.href = '/';
    }
});

// Global modal functions
function closeServiceModal() {
    if (window.adminDashboard) {
        window.adminDashboard.closeServiceModal();
    }
}

function closeUserModal() {
    if (window.adminDashboard) {
        window.adminDashboard.closeUserModal();
    }
}
</script>
</body>
</html>